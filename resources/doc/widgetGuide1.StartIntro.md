# 小组件 API 简介

「即时设计」已正式上线**小组件**并开放相关 API！

小组件是一种全新的交互方式，与插件不同，它可以自由地添加到画布，并且不再限制数量，最重要的是小组件可以**参与到多人协作，让所有人同时运行**。

小组件将进一步扩展「即时设计」的能力，不仅让「即时设计」作为设计工具的功能越发丰富，更能拓宽工具边界，满足不同用户群体的海量需求，例如：

- 嵌入文档编辑器，设计的同时查看或输出文档

- 在设计稿旁添加投票器，让所有人打分互动

- 添加待办事项列表，更直观地管理项目

- 放置一个倒计时器，更好地控制创作时间

还有更多需要发挥你想象力的功能……

## 小组件和插件的差异

由于小组件和插件存在着很多相似之处，所以在开始了解小组件之前，先说明下小组件和插件的区别，便于开发者了解自己的需求和开发目标。

|                  | **小组件**                                      | **插件**                                |
| ---------------- | ----------------------------------------------- | -------------------------------------- |
| 运行数量差异      | 画布内可同时置入多个小组件                   | 每位用户每次只能运行一个插件              |
| 使用范围差异      | 同一文件的所有协作者均可使用                 | 仅支持个人安装及使用          |
| 交互差异         | 多个用户可直接在画布内与同一小组件进行交互（小组件内部也支持嵌入 iframe） | 每位用户都需要与画布外的 iframe 进行交互，且互不影响         |
| 状态差异         | 小组件的当前状态可实时同步，所有协作者可见     | 使用插件为纯个人操作，其他人不可见，仅在修改画布内容后，协作者可看到最终效果 |

总体而言，小组件最适合的用法是在满足更多的**多人协作需求**上，而插件的则依然主要用来提升设计师**个人的创作效率**。

对于开发者来说，以上小组件与插件的定位区分并不绝对，在了解过两者的差异后，可以结合实际场景，来决定哪种形式更符合自己的需求。

## 小组件的运行机制

在「即时设计」[插件 API 的介绍](/developer-doc/plugin/Guide/1.Start/Intro)中，我们已经提到过插件的运行机制，分为在主线程沙箱中运行的 JS 脚本和单独的 iframe 界面，而小组件的运行机制与插件基本一致，同样在沙箱中运行，但又具备一些额外特性：

- 小组件具备状态（States）

- 需要在画布中创建一个自定义对象

- 需要响应自定义对象上的用户交互动作

- 仅在响应用户的交互动作时运行

- 仅在触发当前交互动作的用户端运行

- 在多人协作时，其他用户视图中会自动更新小组件的状态

具体运行流程如下：

![avatar](https://img.js.design/assets/developer-doc/widget/images/intro/run.png)

### 渲染代码

开发插件时，我们只需要考虑 iframe 中的界面搭建，而小组件因为要置于画布中，所以还需要有对应的画布区渲染代码。

不过，小组件的渲染代码是在 API 层面默认强制运行的，不需要开发者处理，并且它和功能代码同步运行的，完全依赖于小组件的状态，从而避免出现多个协作者界面中渲染不一致的问题。

### 状态更新代码

这一部分对小组件来说非常重要，因为它不只是用来改变小组件本身的状态，还可以在更新状态前，通过插件 API 访问甚至读写文件内容，以及打开 iframe 来发送网络请求、获取用户输入操作等等，最终完成小组件的状态更新，并重新在画布中渲染，详细内容会在后续介绍。

### 搭建小组件的外观

小组件的界面，本质上是编辑页图层的组合，我们可以直接使用画板、文本、形状等元素作为小组件的框架、标签、按钮等，然后通过定义这些图层的属性来修改小组件的外观，快速搭建一个小组件。

了解更多可以用在小组件中的图层及相关 API，可查看 [小组件 API 概述 →](/developer-doc/widget/API/1.Reference/1.intro)

![avatar](https://img.js.design/assets/developer-doc/widget/images/intro/ui.png)

### 定义小组件的交互

文件中的每一个协作者都可以与小组件发生交互，而如何发生交互是需要开发者来思考和设计的，比如你可以做一个简单的计数器，添加几个可以交互的按钮，设定一个主题菜单，然后让用户通过点击按钮或修改小组件的属性来运行小组件。

了解更多小组件可添加的交互事件，可查看 [处理用户事件 →](/developer-doc/widget/Guide/2.Development/5.Handling-User-Events)

![avatar](https://img.js.design/assets/developer-doc/widget/images/intro/Interaction.png)

### 使用插件 API

小组件在自身独特的交互之外，还支持使用**插件** **API** 来实现相应功能，比如访问或编辑文件数据、获取外部资源、打开 iframe 实现更丰富的 UI 和功能等等，更多内容可查看 [如何使用插件 API →](/developer-doc/widget/Guide/2.Development/4.Use-PluginAPI)
